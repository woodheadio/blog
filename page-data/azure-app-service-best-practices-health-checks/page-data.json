{"componentChunkName":"component---node-modules-narative-gatsby-theme-novela-src-templates-article-template-tsx","path":"/azure-app-service-best-practices-health-checks","result":{"pageContext":{"article":{"id":"9379e912-dd92-57ca-b9d6-8c76bb867d36","slug":"/azure-app-service-best-practices-health-checks","secret":false,"title":"Azure App Service - Best Practices - Health Checks","author":"Alex Woodhead","date":"July 7th, 2021","dateForSEO":"2021-07-07T00:00:00.000Z","timeToRead":2,"excerpt":"How to configure Azure App Service Health Checks and why you should do so in your production application","canonical_url":null,"subscription":true,"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Azure App Service - Best Practices - Health Checks\",\n  \"author\": \"Alex Woodhead\",\n  \"date\": \"2021-07-07T00:00:00.000Z\",\n  \"hero\": \"./images/azure.jpg\",\n  \"excerpt\": \"How to configure Azure App Service Health Checks and why you should do so in your production application\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h2\", {\n    \"id\": \"why-use-health-checks-with-azure-app-service\"\n  }, \"Why use Health Checks with Azure App Service?\"), mdx(\"p\", null, \"When running an application with Azure App Services in production, it is essential that you consider configuring a health check endpoint for your application. \"), mdx(\"p\", null, \"As part of running a production application, you should have considered scaling out the application to run across multiple \\u2018instances\\u2019. How does Azure know if each of these instances are healthy; through the health check endpoint.\"), mdx(\"p\", null, \"Once the health check endpoint has been configured the App Service load balancer will: \"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Call the endpoint at 1-minute intervals\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Mark the instance as unhealthy if it doesn\\u2019t respond with a 200-299 status code after 2 or more requests\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Instances that remain unhealthy will be replaced if they don\\u2019t recover within 1 hour\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"When scaling up or out, the load balancer will not route requests to the new instances until they respond with a healthy result from the health check endpoint. \")), mdx(\"p\", null, \"The benefits are quite apparent; inform the App Service load balancer on how to monitor the health of your application, and it will ensure your users have a good experience.\"), mdx(\"h2\", {\n    \"id\": \"how-to-configure-the-health-check-endpoint\"\n  }, \"How to configure the Health Check Endpoint\"), mdx(\"p\", null, \"The most simple option for configuring the health check endpoint of your app service is to do so through the Azure portal.\\nIf you navigate to your App Service and select Health Check in the left-hand panel, you can give the relative url to your endpoint and select how long the load balancer will leave an unhealthy instance, before it is removed from circulation: \"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"1918px\"\n    }\n  }), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"47.65380604796663%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAgABBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAe2loJx//8QAGRAAAgMBAAAAAAAAAAAAAAAAAAECERIg/9oACAEBAAEFAsopGY8f/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGBAAAwEBAAAAAAAAAAAAAAAAAAExIJH/2gAIAQEABj8Ci4Qix//EABoQAQACAwEAAAAAAAAAAAAAAAEAERAhgfH/2gAIAQEAAT8hDdFFxSHk8qGf/9oADAMBAAIAAwAAABDAD//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABsQAQACAgMAAAAAAAAAAAAAAAEAERAxUWGB/9oACAEBAAE/ELJ3gI1guEQAoLzNM//Z')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"picture\", {\n    parentName: \"span\"\n  }, \"\\n        \", mdx(\"source\", _extends({\n    parentName: \"picture\"\n  }, {\n    \"srcSet\": [\"/static/1a2eb0de822127e77f52df204706342d/9f870/portal.webp 1918w\"],\n    \"sizes\": \"(max-width: 1918px) 100vw, 1918px\",\n    \"type\": \"image/webp\"\n  })), \"\\n        \", mdx(\"source\", _extends({\n    parentName: \"picture\"\n  }, {\n    \"srcSet\": [\"/static/1a2eb0de822127e77f52df204706342d/cbd8e/portal.jpg 1918w\"],\n    \"sizes\": \"(max-width: 1918px) 100vw, 1918px\",\n    \"type\": \"image/jpeg\"\n  })), \"\\n        \", mdx(\"img\", _extends({\n    parentName: \"picture\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"src\": \"/static/1a2eb0de822127e77f52df204706342d/cbd8e/portal.jpg\",\n    \"alt\": \"Configuring the health check endpoint in the Azure portal\",\n    \"title\": \"Configuring Health Check in Azure Portal\",\n    \"loading\": \"lazy\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    }\n  })), \"\\n      \"), \"\\n    \")), mdx(\"p\", null, \"One of the major flaws of this approach however, is that this WILL CAUSE YOUR APPLICATION TO RESTART! Azure App Service treats any such configuration change as an application change, which will cause the restart, even though your underlying application hasn\\u2019t changed.\"), mdx(\"p\", null, \"As part of this series of posts on Azure App Service Best Practices, I have also covered the topic of \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"/azure-app-service-best-practices-staging-slots\"\n  }), \"App Service Staging Slots\"), \" and why you should use them.\\nThe good news is, if you apply the health check configuration to the staging slot, this will be inherited by the production slot, when swapped, and the application will not restart for your users.\"), mdx(\"p\", null, \"To apply the configuration change to a staging slot, you can use the following Azure CLI command:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"az webapp config set -g [YOUR_RESOURCE_GROUP] -n [YOUR_APP_SERVICE_NAME] -s [YOUR_SLOT_NAME] --generic-configurations \\\"{\\\\`\\\"healthCheckPath\\\\`\\\": \\\\`\\\"[YOUR_HEALTH_CHECK_RELATIVE_URL]\\\\`\\\"}\\\"\\n\")), mdx(\"p\", null, \"Note in the above command the escape characters that are necessary for the Azure CLI to validate the endpoint set within the generic configuration JSON.\"), mdx(\"p\", null, \"Finally, you can then swap the slot with the updated configuration with the production slot, which brings the configuration change to the application seamlessly, without downtime for your users:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"az webapp deployment slot swap  -g [YOUR_RESOURCE_GROUP] -n [YOUR_APP_SERVICE_NAME] --slot [YOUR_SLOT_NAME] --target-slot production\\n\")), mdx(\"h2\", {\n    \"id\": \"further-considerations\"\n  }, \"Further considerations\"), mdx(\"p\", null, \"I would strongly recommend that you hide the availability of the health check endpoint and return a 404 result for all traffic unless it\\u2019s from Azure itself, either localhost or from the v-net that your App Service resides on.\"), mdx(\"p\", null, \"This can be done using the URL Rewrite module in IIS (with rules defined within the web.config file in the root of your application), which Azure App Services respects.\\nTypically, this would be done through the use of a transform file such as below:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-xml\"\n  }), \"<configuration xmlns:xdt=\\\"http://schemas.microsoft.com/XML-Document-Transform\\\">\\n  <system.web>\\n    <compilation xdt:Transform=\\\"RemoveAttributes(debug)\\\" />\\n  </system.web>\\n  <system.webServer>\\n    <rewrite>\\n      <rules xdt:Transform=\\\"Insert\\\">\\n        <rule name=\\\"BlockHealthEndpoints\\\" stopProcessing=\\\"true\\\">\\n          <match url=\\\"^[YOUR_HEALTH_CHECK]\\\" />\\n          <conditions logicalGrouping=\\\"MatchAll\\\">\\n            <!-- Localhost -->\\n            <add input=\\\"{HTTP_HOST}\\\" pattern=\\\"localhost\\\" negate=\\\"true\\\" />\\n            <add input=\\\"{REMOTE_ADDR}\\\" matchType=\\\"Pattern\\\" pattern=\\\"127.0.0.1\\\" negate=\\\"true\\\" />\\n            <!-- VNET IP Range for internal requests -->\\n            <add input=\\\"{REMOTE_ADDR}\\\" matchType=\\\"Pattern\\\" pattern=\\\"[YOUR V-NET IP RANGE: eg. 10.0.*.*]\\\" negate=\\\"true\\\" />                        \\n          </conditions>\\n          <action type=\\\"CustomResponse\\\" statusCode=\\\"404\\\" />\\n        </rule>\\n      </rules>\\n    </rewrite>\\n  </system.webServer>\\n</configuration>\\n\")), mdx(\"h2\", {\n    \"id\": \"summary\"\n  }, \"Summary\"), mdx(\"p\", null, \"I would strongly recommend the use of the Health Check endpoint to inform the App Service load balancer of how to determine if your application instance is healthy.\\nWithout such information, Azure App Services is blind to whether it should continue to serve traffic to an instance of your application or not.\"), mdx(\"p\", null, \"It must be noted that without scaling out your application to at least 2 instances, then this setting will have no effect as the load balancer is disabled with only one running instance to reference.\"));\n}\n;\nMDXContent.isMDXComponent = true;","hero":{"full":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIEBf/EABUBAQEAAAAAAAAAAAAAAAAAAAEE/9oADAMBAAIQAxAAAAHj7YVSQB//xAAZEAACAwEAAAAAAAAAAAAAAAABEgACESD/2gAIAQEAAQUCSKBTeP/EABYRAQEBAAAAAAAAAAAAAAAAAAECEP/aAAgBAwEBPwFpc//EABcRAAMBAAAAAAAAAAAAAAAAAAABAiH/2gAIAQIBAT8BUo0//8QAFxABAAMAAAAAAAAAAAAAAAAAAQARIP/aAAgBAQAGPwKFGf/EABkQAQACAwAAAAAAAAAAAAAAAAEQEQAhMf/aAAgBAQABPyEviiqTTE5P/9oADAMBAAIAAwAAABC/L//EABgRAAIDAAAAAAAAAAAAAAAAAAABETFR/9oACAEDAQE/ELghYf/EABgRAAIDAAAAAAAAAAAAAAAAAAABESFR/9oACAECAQE/EFLROj//xAAaEAADAAMBAAAAAAAAAAAAAAAAAREhQVEQ/9oACAEBAAE/EHaiPlUd8ZfPCuS4Gss//9k=","aspectRatio":2.0521739130434784,"src":"/static/09ee3bf59fbe484ff7904b8d4b9af69f/58fe7/azure.jpg","srcSet":"/static/09ee3bf59fbe484ff7904b8d4b9af69f/e0f30/azure.jpg 236w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/86afd/azure.jpg 472w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/58fe7/azure.jpg 944w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/02748/azure.jpg 1416w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/5c241/azure.jpg 1888w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/e1744/azure.jpg 1918w","srcWebp":"/static/09ee3bf59fbe484ff7904b8d4b9af69f/99fbb/azure.webp","srcSetWebp":"/static/09ee3bf59fbe484ff7904b8d4b9af69f/77392/azure.webp 236w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/1f177/azure.webp 472w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/99fbb/azure.webp 944w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/4a492/azure.webp 1416w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/b0b8f/azure.webp 1888w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/a3ff7/azure.webp 1918w","sizes":"(max-width: 944px) 100vw, 944px"},"regular":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIEBf/EABUBAQEAAAAAAAAAAAAAAAAAAAEE/9oADAMBAAIQAxAAAAHj7YVSQB//xAAZEAACAwEAAAAAAAAAAAAAAAABEgACESD/2gAIAQEAAQUCSKBTeP/EABYRAQEBAAAAAAAAAAAAAAAAAAECEP/aAAgBAwEBPwFpc//EABcRAAMBAAAAAAAAAAAAAAAAAAABAiH/2gAIAQIBAT8BUo0//8QAFxABAAMAAAAAAAAAAAAAAAAAAQARIP/aAAgBAQAGPwKFGf/EABkQAQACAwAAAAAAAAAAAAAAAAEQEQAhMf/aAAgBAQABPyEviiqTTE5P/9oADAMBAAIAAwAAABC/L//EABgRAAIDAAAAAAAAAAAAAAAAAAABETFR/9oACAEDAQE/ELghYf/EABgRAAIDAAAAAAAAAAAAAAAAAAABESFR/9oACAECAQE/EFLROj//xAAaEAADAAMBAAAAAAAAAAAAAAAAAREhQVEQ/9oACAEBAAE/EHaiPlUd8ZfPCuS4Gss//9k=","aspectRatio":2.0375,"src":"/static/09ee3bf59fbe484ff7904b8d4b9af69f/1dc0b/azure.jpg","srcSet":"/static/09ee3bf59fbe484ff7904b8d4b9af69f/3a5ce/azure.jpg 163w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/05730/azure.jpg 327w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/1dc0b/azure.jpg 653w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/f72c7/azure.jpg 980w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/6e4a3/azure.jpg 1306w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/e1744/azure.jpg 1918w","srcWebp":"/static/09ee3bf59fbe484ff7904b8d4b9af69f/0acdf/azure.webp","srcSetWebp":"/static/09ee3bf59fbe484ff7904b8d4b9af69f/ac59e/azure.webp 163w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/7660b/azure.webp 327w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/0acdf/azure.webp 653w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/75470/azure.webp 980w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/68d47/azure.webp 1306w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/a3ff7/azure.webp 1918w","sizes":"(max-width: 653px) 100vw, 653px"},"narrow":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIEBf/EABUBAQEAAAAAAAAAAAAAAAAAAAEE/9oADAMBAAIQAxAAAAHj7YVSQB//xAAZEAACAwEAAAAAAAAAAAAAAAABEgACESD/2gAIAQEAAQUCSKBTeP/EABYRAQEBAAAAAAAAAAAAAAAAAAECEP/aAAgBAwEBPwFpc//EABcRAAMBAAAAAAAAAAAAAAAAAAABAiH/2gAIAQIBAT8BUo0//8QAFxABAAMAAAAAAAAAAAAAAAAAAQARIP/aAAgBAQAGPwKFGf/EABkQAQACAwAAAAAAAAAAAAAAAAEQEQAhMf/aAAgBAQABPyEviiqTTE5P/9oADAMBAAIAAwAAABC/L//EABgRAAIDAAAAAAAAAAAAAAAAAAABETFR/9oACAEDAQE/ELghYf/EABgRAAIDAAAAAAAAAAAAAAAAAAABESFR/9oACAECAQE/EFLROj//xAAaEAADAAMBAAAAAAAAAAAAAAAAAREhQVEQ/9oACAEBAAE/EHaiPlUd8ZfPCuS4Gss//9k=","aspectRatio":2.0357142857142856,"src":"/static/09ee3bf59fbe484ff7904b8d4b9af69f/eaa58/azure.jpg","srcSet":"/static/09ee3bf59fbe484ff7904b8d4b9af69f/5a3ee/azure.jpg 114w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/41f8f/azure.jpg 229w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/eaa58/azure.jpg 457w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/c309b/azure.jpg 686w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/e3008/azure.jpg 914w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/e1744/azure.jpg 1918w","srcWebp":"/static/09ee3bf59fbe484ff7904b8d4b9af69f/15384/azure.webp","srcSetWebp":"/static/09ee3bf59fbe484ff7904b8d4b9af69f/31fce/azure.webp 114w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/e3e25/azure.webp 229w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/15384/azure.webp 457w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/0258d/azure.webp 686w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/64ea2/azure.webp 914w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/a3ff7/azure.webp 1918w","sizes":"(max-width: 457px) 100vw, 457px"},"seo":{"src":"/static/09ee3bf59fbe484ff7904b8d4b9af69f/0ff54/azure.jpg"}}},"authors":[{"authorsPage":true,"bio":"I am passionate about continual self-improvement and learning, working in Agile Scrum environments to\nproduce clean, usable and accessible applications. I love all things .Net, JS and Cloud Native.\n","id":"c7c76bcb-adf2-5cfa-a1ae-ec46a38f737e","name":"Alex Woodhead","featured":true,"social":[{"url":"https://twitter.com/woodheadio"},{"url":"https://github.com/woodheadio"},{"url":"https://www.linkedin.com/in/woodheadio/"}],"slug":"/authors/alex-woodhead","avatar":{"small":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAAFTklEQVQ4yy2T6VdVVRjGzyrv5c7zPRfu5XLxIpMEFwEZHEDoAiHSygkyRMu0aKUmlQ2oUE7JalXiMkUXOQBLBU1JyAGtNEscQMQJUSpr1Ye+9g/8eqE+7LXP2fvs3/s8z7uP0rq7iZadW9kno+OrZjrb9/H1kf10dx6i99Qxrv34Lf2XztK0YwcNH21icOAm/f39jI6OcufeCAN3HnL7wSOGHj7h1qO/UI4ebOHYob0c/Wonba27BbaP3pOHOXe6k0sXz3NgVwPrX5nLqsoymps2MTR0g4Gb12Qe5NbtIe7cv8/dkYfcezzG8NgfKKc79tLb2Upv10F6jrdz/lQHF3qOceNKH00NawlPi6YoLUB+WhwrK1/gRFcbD+7fYPj2VYaH+3kwcovRR/cY++0XfvlTgJe7W7hy+jD9fYe40neAny508cOZU/x4sZPXns/ltbwAmyumcurdcr77op7P69cwdL2HwevnuXb1LNevf8+AqH0wNsrD35+gdLU08s2hHXS3fUpPx6ecPbGHcydb6T6yi7Y35zC8IYvh+lT+3rcYBs7ww+FdXD6xkf7uD7l4/CMun9/Plcu99PRdoPfSVZS1lVW8PyuT7RWL2b+phc8WVtESnk17ST4dr4cZbMzibkMGNzc/y9jXu7nWc46h1gKetLsYORii/+THDB6vZdvSMB+urkWpqaihzuOgKZTNe6tbeGfJUjY8X8z2JeU0Lw/TWODh3BqBL8vl2Ac1/H2pj9ONi9izpYydG6upW/8JDetXs6J4BvkzC1FeLi2nIUZlV3oCq0pms255BbUrXuKzt5axe+UMbqwLMvLlyzzeU8uvrWt53NvFvLzppGfnsmjBAmpfXU5N5ULm5OUQSEhFWZOfR7PPwc45aaxfMoMNbxRRt6yKTXLoxelTWPVcOmWzQlSVl9G+t50t697EYjYQ648kM5RE7dL51MwtJCE+Ef+UZJSNxYUCtLMj/xleLA1Rt2Qax7eVcGRtiLeLk7G4IvGpVlJDWSxbs53qcDYup4VIiSlGoKG0RAryZxETO5nAlASUipRE6kqzWSSWl/vNbJ2fwD9dpdxtzGBFjorLasRtM2K3u0mfHKBqZpD0JB9ut53YQBRT4qLJyZtJYnIaMYFYlASPnQU5BVRXL6YkLZ5tLyTzc30yZ+rSaV35LAWhRJ7L9DMtLpJUv52SrAA+jw2LxYjf58bnVcmankXOrCICsUGUaI+FsoIwzZ8fID8jherpKm2LvfTUV/Jq5Xwcoi4u2obPZSTWa8Vu1WM06bBZDdhtJtwum+QXoChcwtzSMIrqNFE8I4Oa+fNQXRaxqGPeVCcl6UEMRq0c0qNKhh4B2i06HHaJwGUiKsqKTYo5HGYmByKZXZBPUaEAJ7stJHjMxHhMErYRvUGL3mxCq49Ap5s0MSbUCMhsikB1mwTy37vBECGzGW+UnbTUJArD5Sgeqep1GPF6rJjNWrkSejxuB3qdBo3mKSIiJsl4GoNeK0AdVnFgErBGI+u6iIliHtVCbIyLjKwMFLdFiyoVrQI2ijqbdNViFjViV6t9egJokmejjMjx78w6WdNIjkZUb/SE0igREwyo0nEfilNUWaWiXq+ZAI5f2nElXqd5QqVOgEbZM8ie166fABpNArZZiQ7GS45iOdJOfDCSxPgYFIdZg8nw38HxvMbB0ZKTz2UWS5P+tyx7sj6er0kisVpNOJ0OkqY+I81RCfhdpKUEyc6UX89tFVWGSWjEnlayspq0REtHVVHjtkXgc+jwOXUEPXr8qjxHOfH7fQTjgqSkJEl2KnFiNyU5ltzcTP4FmakFHj/BpekAAAAASUVORK5CYII=","aspectRatio":1,"src":"/static/8984ea07f8e557b3ea66113feacbf318/02603/alex-woodhead.png","srcSet":"/static/8984ea07f8e557b3ea66113feacbf318/d406d/alex-woodhead.png 13w,\n/static/8984ea07f8e557b3ea66113feacbf318/12717/alex-woodhead.png 25w,\n/static/8984ea07f8e557b3ea66113feacbf318/02603/alex-woodhead.png 50w,\n/static/8984ea07f8e557b3ea66113feacbf318/5acf8/alex-woodhead.png 75w,\n/static/8984ea07f8e557b3ea66113feacbf318/3ba9f/alex-woodhead.png 100w,\n/static/8984ea07f8e557b3ea66113feacbf318/75682/alex-woodhead.png 1526w","srcWebp":"/static/8984ea07f8e557b3ea66113feacbf318/e7b2c/alex-woodhead.webp","srcSetWebp":"/static/8984ea07f8e557b3ea66113feacbf318/58718/alex-woodhead.webp 13w,\n/static/8984ea07f8e557b3ea66113feacbf318/74aad/alex-woodhead.webp 25w,\n/static/8984ea07f8e557b3ea66113feacbf318/e7b2c/alex-woodhead.webp 50w,\n/static/8984ea07f8e557b3ea66113feacbf318/ed320/alex-woodhead.webp 75w,\n/static/8984ea07f8e557b3ea66113feacbf318/66016/alex-woodhead.webp 100w,\n/static/8984ea07f8e557b3ea66113feacbf318/d1e44/alex-woodhead.webp 1526w","sizes":"(max-width: 50px) 100vw, 50px"},"medium":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAAFTklEQVQ4yy2T6VdVVRjGzyrv5c7zPRfu5XLxIpMEFwEZHEDoAiHSygkyRMu0aKUmlQ2oUE7JalXiMkUXOQBLBU1JyAGtNEscQMQJUSpr1Ye+9g/8eqE+7LXP2fvs3/s8z7uP0rq7iZadW9kno+OrZjrb9/H1kf10dx6i99Qxrv34Lf2XztK0YwcNH21icOAm/f39jI6OcufeCAN3HnL7wSOGHj7h1qO/UI4ebOHYob0c/Wonba27BbaP3pOHOXe6k0sXz3NgVwPrX5nLqsoymps2MTR0g4Gb12Qe5NbtIe7cv8/dkYfcezzG8NgfKKc79tLb2Upv10F6jrdz/lQHF3qOceNKH00NawlPi6YoLUB+WhwrK1/gRFcbD+7fYPj2VYaH+3kwcovRR/cY++0XfvlTgJe7W7hy+jD9fYe40neAny508cOZU/x4sZPXns/ltbwAmyumcurdcr77op7P69cwdL2HwevnuXb1LNevf8+AqH0wNsrD35+gdLU08s2hHXS3fUpPx6ecPbGHcydb6T6yi7Y35zC8IYvh+lT+3rcYBs7ww+FdXD6xkf7uD7l4/CMun9/Plcu99PRdoPfSVZS1lVW8PyuT7RWL2b+phc8WVtESnk17ST4dr4cZbMzibkMGNzc/y9jXu7nWc46h1gKetLsYORii/+THDB6vZdvSMB+urkWpqaihzuOgKZTNe6tbeGfJUjY8X8z2JeU0Lw/TWODh3BqBL8vl2Ac1/H2pj9ONi9izpYydG6upW/8JDetXs6J4BvkzC1FeLi2nIUZlV3oCq0pms255BbUrXuKzt5axe+UMbqwLMvLlyzzeU8uvrWt53NvFvLzppGfnsmjBAmpfXU5N5ULm5OUQSEhFWZOfR7PPwc45aaxfMoMNbxRRt6yKTXLoxelTWPVcOmWzQlSVl9G+t50t697EYjYQ648kM5RE7dL51MwtJCE+Ef+UZJSNxYUCtLMj/xleLA1Rt2Qax7eVcGRtiLeLk7G4IvGpVlJDWSxbs53qcDYup4VIiSlGoKG0RAryZxETO5nAlASUipRE6kqzWSSWl/vNbJ2fwD9dpdxtzGBFjorLasRtM2K3u0mfHKBqZpD0JB9ut53YQBRT4qLJyZtJYnIaMYFYlASPnQU5BVRXL6YkLZ5tLyTzc30yZ+rSaV35LAWhRJ7L9DMtLpJUv52SrAA+jw2LxYjf58bnVcmankXOrCICsUGUaI+FsoIwzZ8fID8jherpKm2LvfTUV/Jq5Xwcoi4u2obPZSTWa8Vu1WM06bBZDdhtJtwum+QXoChcwtzSMIrqNFE8I4Oa+fNQXRaxqGPeVCcl6UEMRq0c0qNKhh4B2i06HHaJwGUiKsqKTYo5HGYmByKZXZBPUaEAJ7stJHjMxHhMErYRvUGL3mxCq49Ap5s0MSbUCMhsikB1mwTy37vBECGzGW+UnbTUJArD5Sgeqep1GPF6rJjNWrkSejxuB3qdBo3mKSIiJsl4GoNeK0AdVnFgErBGI+u6iIliHtVCbIyLjKwMFLdFiyoVrQI2ijqbdNViFjViV6t9egJokmejjMjx78w6WdNIjkZUb/SE0igREwyo0nEfilNUWaWiXq+ZAI5f2nElXqd5QqVOgEbZM8ie166fABpNArZZiQ7GS45iOdJOfDCSxPgYFIdZg8nw38HxvMbB0ZKTz2UWS5P+tyx7sj6er0kisVpNOJ0OkqY+I81RCfhdpKUEyc6UX89tFVWGSWjEnlayspq0REtHVVHjtkXgc+jwOXUEPXr8qjxHOfH7fQTjgqSkJEl2KnFiNyU5ltzcTP4FmakFHj/BpekAAAAASUVORK5CYII=","aspectRatio":1,"src":"/static/8984ea07f8e557b3ea66113feacbf318/3ba9f/alex-woodhead.png","srcSet":"/static/8984ea07f8e557b3ea66113feacbf318/12717/alex-woodhead.png 25w,\n/static/8984ea07f8e557b3ea66113feacbf318/02603/alex-woodhead.png 50w,\n/static/8984ea07f8e557b3ea66113feacbf318/3ba9f/alex-woodhead.png 100w,\n/static/8984ea07f8e557b3ea66113feacbf318/95f17/alex-woodhead.png 150w,\n/static/8984ea07f8e557b3ea66113feacbf318/8ac63/alex-woodhead.png 200w,\n/static/8984ea07f8e557b3ea66113feacbf318/75682/alex-woodhead.png 1526w","srcWebp":"/static/8984ea07f8e557b3ea66113feacbf318/66016/alex-woodhead.webp","srcSetWebp":"/static/8984ea07f8e557b3ea66113feacbf318/74aad/alex-woodhead.webp 25w,\n/static/8984ea07f8e557b3ea66113feacbf318/e7b2c/alex-woodhead.webp 50w,\n/static/8984ea07f8e557b3ea66113feacbf318/66016/alex-woodhead.webp 100w,\n/static/8984ea07f8e557b3ea66113feacbf318/d9b14/alex-woodhead.webp 150w,\n/static/8984ea07f8e557b3ea66113feacbf318/6b183/alex-woodhead.webp 200w,\n/static/8984ea07f8e557b3ea66113feacbf318/d1e44/alex-woodhead.webp 1526w","sizes":"(max-width: 100px) 100vw, 100px"},"large":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAAFTklEQVQ4yy2T6VdVVRjGzyrv5c7zPRfu5XLxIpMEFwEZHEDoAiHSygkyRMu0aKUmlQ2oUE7JalXiMkUXOQBLBU1JyAGtNEscQMQJUSpr1Ye+9g/8eqE+7LXP2fvs3/s8z7uP0rq7iZadW9kno+OrZjrb9/H1kf10dx6i99Qxrv34Lf2XztK0YwcNH21icOAm/f39jI6OcufeCAN3HnL7wSOGHj7h1qO/UI4ebOHYob0c/Wonba27BbaP3pOHOXe6k0sXz3NgVwPrX5nLqsoymps2MTR0g4Gb12Qe5NbtIe7cv8/dkYfcezzG8NgfKKc79tLb2Upv10F6jrdz/lQHF3qOceNKH00NawlPi6YoLUB+WhwrK1/gRFcbD+7fYPj2VYaH+3kwcovRR/cY++0XfvlTgJe7W7hy+jD9fYe40neAny508cOZU/x4sZPXns/ltbwAmyumcurdcr77op7P69cwdL2HwevnuXb1LNevf8+AqH0wNsrD35+gdLU08s2hHXS3fUpPx6ecPbGHcydb6T6yi7Y35zC8IYvh+lT+3rcYBs7ww+FdXD6xkf7uD7l4/CMun9/Plcu99PRdoPfSVZS1lVW8PyuT7RWL2b+phc8WVtESnk17ST4dr4cZbMzibkMGNzc/y9jXu7nWc46h1gKetLsYORii/+THDB6vZdvSMB+urkWpqaihzuOgKZTNe6tbeGfJUjY8X8z2JeU0Lw/TWODh3BqBL8vl2Ac1/H2pj9ONi9izpYydG6upW/8JDetXs6J4BvkzC1FeLi2nIUZlV3oCq0pms255BbUrXuKzt5axe+UMbqwLMvLlyzzeU8uvrWt53NvFvLzppGfnsmjBAmpfXU5N5ULm5OUQSEhFWZOfR7PPwc45aaxfMoMNbxRRt6yKTXLoxelTWPVcOmWzQlSVl9G+t50t697EYjYQ648kM5RE7dL51MwtJCE+Ef+UZJSNxYUCtLMj/xleLA1Rt2Qax7eVcGRtiLeLk7G4IvGpVlJDWSxbs53qcDYup4VIiSlGoKG0RAryZxETO5nAlASUipRE6kqzWSSWl/vNbJ2fwD9dpdxtzGBFjorLasRtM2K3u0mfHKBqZpD0JB9ut53YQBRT4qLJyZtJYnIaMYFYlASPnQU5BVRXL6YkLZ5tLyTzc30yZ+rSaV35LAWhRJ7L9DMtLpJUv52SrAA+jw2LxYjf58bnVcmankXOrCICsUGUaI+FsoIwzZ8fID8jherpKm2LvfTUV/Jq5Xwcoi4u2obPZSTWa8Vu1WM06bBZDdhtJtwum+QXoChcwtzSMIrqNFE8I4Oa+fNQXRaxqGPeVCcl6UEMRq0c0qNKhh4B2i06HHaJwGUiKsqKTYo5HGYmByKZXZBPUaEAJ7stJHjMxHhMErYRvUGL3mxCq49Ap5s0MSbUCMhsikB1mwTy37vBECGzGW+UnbTUJArD5Sgeqep1GPF6rJjNWrkSejxuB3qdBo3mKSIiJsl4GoNeK0AdVnFgErBGI+u6iIliHtVCbIyLjKwMFLdFiyoVrQI2ijqbdNViFjViV6t9egJokmejjMjx78w6WdNIjkZUb/SE0igREwyo0nEfilNUWaWiXq+ZAI5f2nElXqd5QqVOgEbZM8ie166fABpNArZZiQ7GS45iOdJOfDCSxPgYFIdZg8nw38HxvMbB0ZKTz2UWS5P+tyx7sj6er0kisVpNOJ0OkqY+I81RCfhdpKUEyc6UX89tFVWGSWjEnlayspq0REtHVVHjtkXgc+jwOXUEPXr8qjxHOfH7fQTjgqSkJEl2KnFiNyU5ltzcTP4FmakFHj/BpekAAAAASUVORK5CYII=","aspectRatio":1,"src":"/static/8984ea07f8e557b3ea66113feacbf318/19999/alex-woodhead.png","srcSet":"/static/8984ea07f8e557b3ea66113feacbf318/6bc0d/alex-woodhead.png 82w,\n/static/8984ea07f8e557b3ea66113feacbf318/6a68f/alex-woodhead.png 164w,\n/static/8984ea07f8e557b3ea66113feacbf318/19999/alex-woodhead.png 328w,\n/static/8984ea07f8e557b3ea66113feacbf318/adfab/alex-woodhead.png 492w,\n/static/8984ea07f8e557b3ea66113feacbf318/75b99/alex-woodhead.png 656w,\n/static/8984ea07f8e557b3ea66113feacbf318/75682/alex-woodhead.png 1526w","srcWebp":"/static/8984ea07f8e557b3ea66113feacbf318/5a48e/alex-woodhead.webp","srcSetWebp":"/static/8984ea07f8e557b3ea66113feacbf318/2d087/alex-woodhead.webp 82w,\n/static/8984ea07f8e557b3ea66113feacbf318/29d87/alex-woodhead.webp 164w,\n/static/8984ea07f8e557b3ea66113feacbf318/5a48e/alex-woodhead.webp 328w,\n/static/8984ea07f8e557b3ea66113feacbf318/42f2e/alex-woodhead.webp 492w,\n/static/8984ea07f8e557b3ea66113feacbf318/dec03/alex-woodhead.webp 656w,\n/static/8984ea07f8e557b3ea66113feacbf318/d1e44/alex-woodhead.webp 1526w","sizes":"(max-width: 328px) 100vw, 328px"}}}],"basePath":"/","permalink":"https://woodhead.io/azure-app-service-best-practices-health-checks/","slug":"/azure-app-service-best-practices-health-checks","id":"9379e912-dd92-57ca-b9d6-8c76bb867d36","title":"Azure App Service - Best Practices - Health Checks","canonicalUrl":null,"mailchimp":"","next":[{"id":"f15eb676-0739-5497-a9c9-ded61184ab96","slug":"/azure-app-service-best-practices-staging-slots","secret":false,"title":"Azure App Service - Best Practices - Staging Slots","author":"Alex Woodhead","date":"June 30th, 2021","dateForSEO":"2021-06-30T00:00:00.000Z","timeToRead":3,"excerpt":"How to make use of staging slots in Azure App Services for Zero-Downtime releases","canonical_url":null,"subscription":true,"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Azure App Service - Best Practices - Staging Slots\",\n  \"author\": \"Alex Woodhead\",\n  \"date\": \"2021-06-30T00:00:00.000Z\",\n  \"hero\": \"./images/azure.jpg\",\n  \"excerpt\": \"How to make use of staging slots in Azure App Services for Zero-Downtime releases\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h2\", {\n    \"id\": \"why-use-staging-slots-with-azure-app-services\"\n  }, \"Why use Staging Slots with Azure App Services?\"), mdx(\"p\", null, \"Making use of staging slots within Azure App Services is a recommended best-practice by Microsoft for all Production applications.\\nUtilising deployment slots enables:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Zero downtime updates to your application\\u2019s code\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Configuration changes applied and tested prior to swapping the slots\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Better perceived performance by application users, who don\\u2019t have to witness application warmup\")), mdx(\"p\", null, \"To make use of deployment slots, your App Service has to be on the appropriate level of App Service Plan, which at the time of writing is the \\u201CStandard\\u201D plan level and above.\\nSee \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.microsoft.com/en-gb/azure/azure-resource-manager/management/azure-subscription-service-limits#app-service-limits\",\n    \"target\": \"_blank\",\n    \"rel\": \"noreferrer\"\n  }), \"Microsoft\\u2019s App Service Limits documentation for details\"), \". \"), mdx(\"h2\", {\n    \"id\": \"creating-and-configuring-an-azure-app-service-staging-slot\"\n  }, \"Creating and configuring an Azure App Service Staging Slot:\"), mdx(\"p\", null, \"Creating the deployment slot to deploy to is a one-line command with the Azure CLI:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"az webapp deployment slot create -n [YOUR_APP_SERVICE_NAME] -g [YOUR_RESOURCE_GROUP] -s [YOUR_SLOT_NAME]\\n\")), mdx(\"p\", null, \"You may want to configure the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"/azure-app-service-best-practices-health-checks\"\n  }), \"health check endpoint\"), \" for the App Service, so the load balancer can detect whether an instance is healthy. This will be transferred across to the Production slot when the slots are swapped:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"az webapp config set -g [YOUR_RESOURCE_GROUP] -n [YOUR_APP_SERVICE_NAME] -s [YOUR_SLOT_NAME] --generic-configurations \\\"{\\\\`\\\"healthCheckPath\\\\`\\\": \\\\`\\\"[YOUR_HEALTH_CHECK_RELATIVE_URL]\\\\`\\\"}\\\"\\n\")), mdx(\"p\", null, \"You may also want to disable ARR Affinity (Sticky Sessions), so that users aren\\u2019t stuck on an unhealthy instance.\\nThis is dependent on your application either being stateless, or maintaining state in a centralised store, such as SQL Server or Redis. \"), mdx(\"p\", null, \"The command for disabling Arr Affinity (Sticky Sessions) is:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"az webapp update -n [YOUR_APP_SERVICE_NAME] -g [YOUR_RESOURCE_GROUP] -s [YOUR_SLOT_NAME] --client-affinity-enabled false\\n\")), mdx(\"h2\", {\n    \"id\": \"deploying-to-an-app-service-slot-with-azure-devops\"\n  }, \"Deploying to an App Service Slot with Azure DevOps\"), mdx(\"h3\", {\n    \"id\": \"create-an-azure-classic-service-connection\"\n  }, \"Create an Azure Classic Service Connection\"), mdx(\"p\", null, \"Firstly you will need to create an Azure Service Connection within your Azure DevOps instance that can be referenced within the pipelines.\\nThis will make use of a service principle account, which will need to have the required permissions within your Azure estate to provision and administrate resources.\"), mdx(\"p\", null, \"Firstly Navigate to the Service Connections page within your Azure DevOps project (you will need to be a Project Administrator to access these settings). Select New Service Connection.\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"1920px\"\n    }\n  }), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"48.802083333333336%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAxUlEQVQoz62SywrCMBBF8/9f5kLQlQvFpYhIm3fzaPF6pyjYjVrt4hAIk5ObmSjrLWKI8N7DGoMYI/q+/0jOCV2XWX9GCFs4t8PlfIIyRsNaC601Nx1SSqi1opTyllqFASVfGWZD+RGVF6ngA28Io0wKc84zSKSSGxnGMEozoTxXhFIkm9/zrO/GVc6rVrfsnZ0I56WchlBt20D66Jz/WfgKhZ49zI+E5X9h06w44QOFYamEawr3HExcRmiM9K7nP+oWEd4BTLoI+KOB54MAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"picture\", {\n    parentName: \"span\"\n  }, \"\\n        \", mdx(\"source\", _extends({\n    parentName: \"picture\"\n  }, {\n    \"srcSet\": [\"/static/a8b64521d71723b7cad0080b2d88f6b5/f3ff0/service-connections-1.webp 1920w\"],\n    \"sizes\": \"(max-width: 1920px) 100vw, 1920px\",\n    \"type\": \"image/webp\"\n  })), \"\\n        \", mdx(\"source\", _extends({\n    parentName: \"picture\"\n  }, {\n    \"srcSet\": [\"/static/a8b64521d71723b7cad0080b2d88f6b5/7d442/service-connections-1.png 1920w\"],\n    \"sizes\": \"(max-width: 1920px) 100vw, 1920px\",\n    \"type\": \"image/png\"\n  })), \"\\n        \", mdx(\"img\", _extends({\n    parentName: \"picture\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"src\": \"/static/a8b64521d71723b7cad0080b2d88f6b5/7d442/service-connections-1.png\",\n    \"alt\": \"Select Service Connections within your Project Settings\",\n    \"title\": \"Select Service Connections within your Project Settings\",\n    \"loading\": \"lazy\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    }\n  })), \"\\n      \"), \"\\n    \")), mdx(\"p\", null, \"Next Select \\u201CAzure Classic\\u201D as the type of Service Connection that you want to create.\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"1920px\"\n    }\n  }), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"45.833333333333336%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABLElEQVQoz43SXW+CMBgFYP7/z8FMUaEtSvkYM7vYbk12sSDGyUewIiielaojbnFKcm5o++SkbzUyIGA2w2QyUaGUwnEcBEEA3/f/pP3veR5ms1fEiwhRFCFNM5RliTheQOv1RxKyQQhR4HQ6heu66tCtcO4hfGFYF+8SesN+X6D94jiGpj/1FMIYU81a7F64wyXoYS0+sBFziW7OoGzY1w1QRsFoB3LOb6Zdb/eF4QyrvILY1miaY9fQ7A8lyEAscgX+1/AEPiNLVqjrCsfjCVwulxK0LFjn3AOvG4YoxBZV1YFJkkBrIdu21R1eBvIomGa5bFhLsFHgOkmhjcZjGIYB0zR/DjwKZhIUQmB/OCiwyL/kUAZDORCqnszvy78HlrsKzbnd7vCJYK7jGzgyajgXQXKpAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"picture\", {\n    parentName: \"span\"\n  }, \"\\n        \", mdx(\"source\", _extends({\n    parentName: \"picture\"\n  }, {\n    \"srcSet\": [\"/static/33c3aab6b101111140a9e6cd90512685/f3ff0/service-connections-2.webp 1920w\"],\n    \"sizes\": \"(max-width: 1920px) 100vw, 1920px\",\n    \"type\": \"image/webp\"\n  })), \"\\n        \", mdx(\"source\", _extends({\n    parentName: \"picture\"\n  }, {\n    \"srcSet\": [\"/static/33c3aab6b101111140a9e6cd90512685/7d442/service-connections-2.png 1920w\"],\n    \"sizes\": \"(max-width: 1920px) 100vw, 1920px\",\n    \"type\": \"image/png\"\n  })), \"\\n        \", mdx(\"img\", _extends({\n    parentName: \"picture\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"src\": \"/static/33c3aab6b101111140a9e6cd90512685/7d442/service-connections-2.png\",\n    \"alt\": \"Select Azure Classic\",\n    \"title\": \"Select Azure Classic\",\n    \"loading\": \"lazy\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    }\n  })), \"\\n      \"), \"\\n    \")), mdx(\"p\", null, \"Finally, input the details of your Azure Subscription and the Service Principle Credentials that are required to access Azure and create/manage resources:\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"1920px\"\n    }\n  }), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"48.75000000000001%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA80lEQVQoz52SS46DMBBEuf+NWOEP3yMEyMaAmERZjLIBbKDGbQ2ZECWKM0ilWrj1VNVNwAVHkiRgjCG2XhQF8jx3/kzbW5qmOByP6M9nnC4XfF+vOJQlAimFA0opndPgO2VZBiEElGpgtMb21XWNgB62QQL6iGY552ibBsM4OmkLLilhxKLdoG9CAnZdZ0EG2his64qqqiwwiryTPSZUSmGaJgzD4NwBGeO3uvf+SrvKbYvR1h1/KztgGIaI43i3Q18gVTbzjNmKKu+O8p+EBCSYsTskd0e5T+cLvB2l/8KyLHZ/+u+3eaz60Q77kwNR3e0oP40ZrhbHinUoAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"picture\", {\n    parentName: \"span\"\n  }, \"\\n        \", mdx(\"source\", _extends({\n    parentName: \"picture\"\n  }, {\n    \"srcSet\": [\"/static/255a71ed4e3e37548369f186addfd871/f3ff0/service-connections-3.webp 1920w\"],\n    \"sizes\": \"(max-width: 1920px) 100vw, 1920px\",\n    \"type\": \"image/webp\"\n  })), \"\\n        \", mdx(\"source\", _extends({\n    parentName: \"picture\"\n  }, {\n    \"srcSet\": [\"/static/255a71ed4e3e37548369f186addfd871/7d442/service-connections-3.png 1920w\"],\n    \"sizes\": \"(max-width: 1920px) 100vw, 1920px\",\n    \"type\": \"image/png\"\n  })), \"\\n        \", mdx(\"img\", _extends({\n    parentName: \"picture\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"src\": \"/static/255a71ed4e3e37548369f186addfd871/7d442/service-connections-3.png\",\n    \"alt\": \"Input Subscription Details and Service Principle Credentials\",\n    \"title\": \"Input Subscription Details and Service Principle Credentials\",\n    \"loading\": \"lazy\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    }\n  })), \"\\n      \"), \"\\n    \")), mdx(\"p\", null, \"Ensure on the final step that you make sure to enable \\u201CGrant access permissions to all pipelines\\u201D, which will enable the Service Connection to be used in pipelines created within your project.\"), mdx(\"h3\", {\n    \"id\": \"create-and-configure-a-deployment-slot-in-an-azure-devops-pipeline\"\n  }, \"Create and configure a deployment slot in an Azure DevOps pipeline\"), mdx(\"p\", null, \"Making use of the Azure CLI Task available within Azure DevOps enables you to call the necessary Azure CLI commands to create and configure a staging deployment slot for your app service.\\nThe YAML for the task is shown below:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-yaml\"\n  }), \"- task: AzureCLI@2\\n  displayName: 'Create and Configure Slot'\\n  inputs:\\n    azureSubscription: '[YOUR_AZURE_SERVICE_CONNECTION_NAME - SEE ABOVE]'\\n    scriptType: ps\\n    scriptLocation: inlineScript\\n    inlineScript: |\\n     az webapp deployment slot create -n [YOUR_APP_SERVICE_NAME] -g [YOUR_RESOURCE_GROUP] -s [YOUR_SLOT_NAME]     \\n     az webapp update -n [YOUR_APP_SERVICE_NAME] -g [YOUR_RESOURCE_GROUP] -s [YOUR_SLOT_NAME] --client-affinity-enabled true     \\n     az webapp config set -g [YOUR_RESOURCE_GROUP] -n [YOUR_APP_SERVICE_NAME] -s [YOUR_SLOT_NAME] --use-32bit-worker-process false\\n     az webapp config set -g [YOUR_RESOURCE_GROUP] -n [YOUR_APP_SERVICE_NAME] -s [YOUR_SLOT_NAME] --generic-configurations \\\"{\\\\`\\\"healthCheckPath\\\\`\\\": \\\\`\\\"/api/health/\\\\`\\\"}\\\"\\n\")), mdx(\"p\", null, \"Having created and configured the slot, you can now have a second task in your pipeline that will deploy an artefact to that slot:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-yaml\"\n  }), \"- task: AzureRmWebAppDeployment@4\\n  displayName: 'Deploy Candidate to slot'\\n  inputs:\\n    azureSubscription: '[YOUR_AZURE_SERVICE_CONNECTION_NAME - SEE ABOVE]'\\n    WebAppName: '[YOUR_APP_SERVICE_NAME]'\\n    deployToSlotOrASE: true\\n    ResourceGroupName: '[YOUR_RESOURCE_GROUP]'\\n    SlotName: [YOUR_SLOT_NAME]\\n    packageForLinux: '$(System.DefaultWorkingDirectory)/**/*[YOUR_BUILD_ARTEFACT_NAME].zip'\\n    enableCustomDeployment: true\\n    RemoveAdditionalFilesFlag: true\\n    ExcludeFilesFromAppDataFlag: false\\n    enableXmlTransform: true\\n    enableXmlVariableSubstitution: false    \\n\")), mdx(\"p\", null, \"Finally, having either run automated tests, or manually verified that the application is running correctly, you can now swap the slots,\\nwith the new slot replacing the production slot for your App Service. This results in a seamless transition to the latest version of your application:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-yaml\"\n  }), \"- task: AzureAppServiceManage@0\\n  displayName: 'Swap Deployment Slots:'\\n  inputs:\\n    azureSubscription: '[YOUR_AZURE_SERVICE_CONNECTION_NAME - SEE ABOVE]'\\n    WebAppName: '[YOUR_APP_SERVICE_NAME]'\\n    ResourceGroupName: '[YOUR_RESOURCE_GROUP]'\\n    SourceSlot: [YOUR_SLOT_NAME]\\n    PreserveVnet: true\\n\")), mdx(\"h2\", {\n    \"id\": \"further-considerations\"\n  }, \"Further considerations\"), mdx(\"p\", null, \"Having worked with deployment slots, and the App Service Manage task referenced above in production scenarios, I have witnessed occasional disparities between when the task\\nreports that the slots have swapped and when Azure actually completes the process.\"), mdx(\"p\", null, \"Having raised a support case with Microsoft on the matter, the advice received was to query the App Service logs to ascertain if the slow swap had completed.\\nWanting to ensure that this could be automated, the following powershell script was produced, which would poll the logs until receiving the correct \\u201CSucceeded\\u201D state and wrapped in a DevOps powershell task:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-yaml\"\n  }), \"- task: AzurePowerShell@5\\n  displayName: 'Query logs to ensure swap complete'\\n  inputs:\\n    azureSubscription: '[YOUR_AZURE_SERVICE_CONNECTION_NAME - SEE ABOVE]'\\n    ScriptType: InlineScript\\n    Inline: |\\n      $azureSubscriptionId = \\\"[YOUR_SUBSCRIPTION_ID]\\\"\\n      $azureResourceGroup = \\\"[YOUR_RESOURCE_GROUP]\\\"\\n      $azureAppServiceName = \\\"[YOUR_APP_SERVICE_NAME]\\\"\\n\\n      Write-Output \\\"Query Logs to confirm swap completion\\\"\\n\\n      $date = Get-Date\\n      $date = $date.AddMinutes(-30)\\n\\n      [bool] $swapComplete = 0\\n      $logCheckCount = 0\\n\\n      while(!$swapComplete){\\n          $logCheckCount++\\n\\n          $logs = Get-AzLog -ResourceId \\\"/subscriptions/$azureSubscriptionId/resourceGroups/$azureResourceGroup/providers/Microsoft.Web/sites/$azureAppServiceName/slots/staging\\\" -StartTime $date\\n\\n          $logs | where { $_.operationName.value -match 'Microsoft.Web/sites/slots/slotsswap/action' -or $_.operationName.value -match 'Microsoft.Web/sites/slots/SlotSwap/action' } | Sort-Object eventTimestamp  | ForEach-Object {\\n            Write-Host $_.eventTimestamp $_.status.value $_.description\\n          }\\n\\n          Write-Output $logs[0]\\n          $LastLogObject = $logs[0]\\n          $LastLogStatus = $LastLogObject.Status.Value\\n\\n          Write-Output \\\"Last log entry status: $LastLogStatus\\\"\\n\\n          if($LastLogObject.Status.Value -eq \\\"Succeeded\\\"){\\n              $swapComplete = 1\\n              break\\n          }\\n\\n          Write-Output \\\"Checked logs $logCheckCount times\\\"\\n\\n          if($logCheckCount -eq 20){\\n              throw  \\\"Retry count exceeded\\\"\\n          }\\n\\n          Write-Output \\\"Waiting 30 seconds before checking again\\\"\\n\\n          Start-Sleep -s 30\\n      }\\n    azurePowerShellVersion: LatestVersion\\n\")), mdx(\"p\", null, \"This felt an unfortunate necessity at the time. Hopefully the App Service Manage task within DevOps will be enhanced in the future to correctly identify the point in time\\nat which the swap has completed, before allowing the pipeline to continue.\"), mdx(\"h2\", {\n    \"id\": \"summary\"\n  }, \"Summary\"), mdx(\"p\", null, \"I would consider making use of deployment slots within Azure App Services an essential, within a production application. Without utilising deployment slots, users of\\nthe application will witness application restarts and warmups, causing a loss of credibility of your application.\"), mdx(\"p\", null, \"Further to this, adding the ability to conduct quick automated smoke tests against your application running in the production environment, along with any configuration changes, is likely to reduce everyone\\u2019s stress levels. So why not get started with deployment slots today?\"));\n}\n;\nMDXContent.isMDXComponent = true;","hero":{"full":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIEBf/EABUBAQEAAAAAAAAAAAAAAAAAAAEE/9oADAMBAAIQAxAAAAHj7YVSQB//xAAZEAACAwEAAAAAAAAAAAAAAAABEgACESD/2gAIAQEAAQUCSKBTeP/EABYRAQEBAAAAAAAAAAAAAAAAAAECEP/aAAgBAwEBPwFpc//EABcRAAMBAAAAAAAAAAAAAAAAAAABAiH/2gAIAQIBAT8BUo0//8QAFxABAAMAAAAAAAAAAAAAAAAAAQARIP/aAAgBAQAGPwKFGf/EABkQAQACAwAAAAAAAAAAAAAAAAEQEQAhMf/aAAgBAQABPyEviiqTTE5P/9oADAMBAAIAAwAAABC/L//EABgRAAIDAAAAAAAAAAAAAAAAAAABETFR/9oACAEDAQE/ELghYf/EABgRAAIDAAAAAAAAAAAAAAAAAAABESFR/9oACAECAQE/EFLROj//xAAaEAADAAMBAAAAAAAAAAAAAAAAAREhQVEQ/9oACAEBAAE/EHaiPlUd8ZfPCuS4Gss//9k=","aspectRatio":2.0521739130434784,"src":"/static/09ee3bf59fbe484ff7904b8d4b9af69f/58fe7/azure.jpg","srcSet":"/static/09ee3bf59fbe484ff7904b8d4b9af69f/e0f30/azure.jpg 236w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/86afd/azure.jpg 472w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/58fe7/azure.jpg 944w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/02748/azure.jpg 1416w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/5c241/azure.jpg 1888w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/e1744/azure.jpg 1918w","srcWebp":"/static/09ee3bf59fbe484ff7904b8d4b9af69f/99fbb/azure.webp","srcSetWebp":"/static/09ee3bf59fbe484ff7904b8d4b9af69f/77392/azure.webp 236w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/1f177/azure.webp 472w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/99fbb/azure.webp 944w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/4a492/azure.webp 1416w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/b0b8f/azure.webp 1888w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/a3ff7/azure.webp 1918w","sizes":"(max-width: 944px) 100vw, 944px"},"regular":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIEBf/EABUBAQEAAAAAAAAAAAAAAAAAAAEE/9oADAMBAAIQAxAAAAHj7YVSQB//xAAZEAACAwEAAAAAAAAAAAAAAAABEgACESD/2gAIAQEAAQUCSKBTeP/EABYRAQEBAAAAAAAAAAAAAAAAAAECEP/aAAgBAwEBPwFpc//EABcRAAMBAAAAAAAAAAAAAAAAAAABAiH/2gAIAQIBAT8BUo0//8QAFxABAAMAAAAAAAAAAAAAAAAAAQARIP/aAAgBAQAGPwKFGf/EABkQAQACAwAAAAAAAAAAAAAAAAEQEQAhMf/aAAgBAQABPyEviiqTTE5P/9oADAMBAAIAAwAAABC/L//EABgRAAIDAAAAAAAAAAAAAAAAAAABETFR/9oACAEDAQE/ELghYf/EABgRAAIDAAAAAAAAAAAAAAAAAAABESFR/9oACAECAQE/EFLROj//xAAaEAADAAMBAAAAAAAAAAAAAAAAAREhQVEQ/9oACAEBAAE/EHaiPlUd8ZfPCuS4Gss//9k=","aspectRatio":2.0375,"src":"/static/09ee3bf59fbe484ff7904b8d4b9af69f/1dc0b/azure.jpg","srcSet":"/static/09ee3bf59fbe484ff7904b8d4b9af69f/3a5ce/azure.jpg 163w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/05730/azure.jpg 327w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/1dc0b/azure.jpg 653w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/f72c7/azure.jpg 980w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/6e4a3/azure.jpg 1306w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/e1744/azure.jpg 1918w","srcWebp":"/static/09ee3bf59fbe484ff7904b8d4b9af69f/0acdf/azure.webp","srcSetWebp":"/static/09ee3bf59fbe484ff7904b8d4b9af69f/ac59e/azure.webp 163w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/7660b/azure.webp 327w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/0acdf/azure.webp 653w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/75470/azure.webp 980w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/68d47/azure.webp 1306w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/a3ff7/azure.webp 1918w","sizes":"(max-width: 653px) 100vw, 653px"},"narrow":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIEBf/EABUBAQEAAAAAAAAAAAAAAAAAAAEE/9oADAMBAAIQAxAAAAHj7YVSQB//xAAZEAACAwEAAAAAAAAAAAAAAAABEgACESD/2gAIAQEAAQUCSKBTeP/EABYRAQEBAAAAAAAAAAAAAAAAAAECEP/aAAgBAwEBPwFpc//EABcRAAMBAAAAAAAAAAAAAAAAAAABAiH/2gAIAQIBAT8BUo0//8QAFxABAAMAAAAAAAAAAAAAAAAAAQARIP/aAAgBAQAGPwKFGf/EABkQAQACAwAAAAAAAAAAAAAAAAEQEQAhMf/aAAgBAQABPyEviiqTTE5P/9oADAMBAAIAAwAAABC/L//EABgRAAIDAAAAAAAAAAAAAAAAAAABETFR/9oACAEDAQE/ELghYf/EABgRAAIDAAAAAAAAAAAAAAAAAAABESFR/9oACAECAQE/EFLROj//xAAaEAADAAMBAAAAAAAAAAAAAAAAAREhQVEQ/9oACAEBAAE/EHaiPlUd8ZfPCuS4Gss//9k=","aspectRatio":2.0357142857142856,"src":"/static/09ee3bf59fbe484ff7904b8d4b9af69f/eaa58/azure.jpg","srcSet":"/static/09ee3bf59fbe484ff7904b8d4b9af69f/5a3ee/azure.jpg 114w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/41f8f/azure.jpg 229w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/eaa58/azure.jpg 457w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/c309b/azure.jpg 686w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/e3008/azure.jpg 914w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/e1744/azure.jpg 1918w","srcWebp":"/static/09ee3bf59fbe484ff7904b8d4b9af69f/15384/azure.webp","srcSetWebp":"/static/09ee3bf59fbe484ff7904b8d4b9af69f/31fce/azure.webp 114w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/e3e25/azure.webp 229w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/15384/azure.webp 457w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/0258d/azure.webp 686w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/64ea2/azure.webp 914w,\n/static/09ee3bf59fbe484ff7904b8d4b9af69f/a3ff7/azure.webp 1918w","sizes":"(max-width: 457px) 100vw, 457px"},"seo":{"src":"/static/09ee3bf59fbe484ff7904b8d4b9af69f/0ff54/azure.jpg"}}},{"id":"07a7abe4-0484-503d-a86f-93e4ce508e0d","slug":"/simple-guide-to-upgrading-aks-clusters-on-azure","secret":false,"title":"Simple guide to upgrading AKS Clusters on Azure","author":"Alex Woodhead","date":"September 27th, 2020","dateForSEO":"2020-09-27T00:00:00.000Z","timeToRead":1,"excerpt":"Quick and simple guide to upgrading AKS clusters on Microsoft Azure","canonical_url":null,"subscription":true,"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Simple guide to upgrading AKS Clusters on Azure\",\n  \"author\": \"Alex Woodhead\",\n  \"date\": \"2020-09-27T00:00:00.000Z\",\n  \"hero\": \"./images/aks.jpg\",\n  \"excerpt\": \"Quick and simple guide to upgrading AKS clusters on Microsoft Azure\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Upgrading you AKS cluster on Azure is a very simple process. The following commands used were all taken from the\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.microsoft.com/en-us/azure/aks/upgrade-cluster\",\n    \"target\": \"_blank\",\n    \"rel\": \"noreferrer\"\n  }), \"documentation\")), mdx(\"h2\", {\n    \"id\": \"determine-which-version-you-can-upgrade-to\"\n  }, \"Determine which version you can upgrade to\"), mdx(\"p\", null, \"Firstly, you need to identify the versions that are available to your cluster within the region that it is deployed within:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"C:\\\\> az aks get-versions --location uksouth --output table\\n\")), mdx(\"p\", null, \"This will output the available versions that can be upgraded to in the region that your AKS cluster is hosted within:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"KubernetesVersion    Upgrades\\n-------------------  -----------------------\\n1.18.8               None available\\n1.18.6               1.18.8\\n1.17.9               1.18.6, 1.18.8\\n1.17.7               1.17.9, 1.18.6, 1.18.8\\n1.16.13              1.17.7, 1.17.9\\n1.16.10              1.16.13, 1.17.7, 1.17.9\\nC:\\\\>\\n\")), mdx(\"p\", null, \"You are only able to upgrade minor versions at a time with AKS, but if you have fallen outside of the supported version the version you can upgrade to will be the minimum, supported version on AKS. There may be a need to upgrade multiple times to arrive at your destination version.\"), mdx(\"p\", null, \"Next run a command to determine which is the next version(s) you can upgrade to from you current version:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"C:\\\\> az aks get-upgrades --resource-group *** --name ***\\n\")), mdx(\"p\", null, \"This will output the versions that both your control plane and nodes are running against along with the version they can be upgraded to:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-json\"\n  }), \"{\\n  \\\"agentPoolProfiles\\\": [\\n    {\\n      \\\"kubernetesVersion\\\": \\\"1.13.10\\\",\\n      \\\"name\\\": null,\\n      \\\"osType\\\": \\\"Linux\\\",\\n      \\\"upgrades\\\": [\\n        {\\n          \\\"isPreview\\\": null,\\n          \\\"kubernetesVersion\\\": \\\"1.16.10\\\"\\n        },\\n        {\\n          \\\"isPreview\\\": null,\\n          \\\"kubernetesVersion\\\": \\\"1.16.13\\\"\\n        }\\n      ]\\n    }\\n  ],\\n  \\\"controlPlaneProfile\\\": {\\n    \\\"kubernetesVersion\\\": \\\"1.13.10\\\",\\n    \\\"name\\\": null,\\n    \\\"osType\\\": \\\"Linux\\\",\\n    \\\"upgrades\\\": [\\n      {\\n        \\\"isPreview\\\": null,\\n        \\\"kubernetesVersion\\\": \\\"1.16.10\\\"\\n      },\\n      {\\n        \\\"isPreview\\\": null,\\n        \\\"kubernetesVersion\\\": \\\"1.16.13\\\"\\n      }\\n    ]\\n  },\\n  \\\"id\\\": \\\"/subscriptions/***/resourcegroups/***/providers/Microsoft.ContainerService/...\\\",\\n  \\\"name\\\": \\\"default\\\",\\n  \\\"resourceGroup\\\": \\\"***\\\",\\n  \\\"type\\\": \\\"Microsoft.ContainerService/managedClusters/upgradeprofiles\\\"\\n}\\n\")), mdx(\"h3\", {\n    \"id\": \"upgrade-you-cluster\"\n  }, \"Upgrade you Cluster\"), mdx(\"p\", null, \"Next step is to execute the command to upgrade to a specific version:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"C:\\\\> az aks upgrade --resource-group *** --name *** --kubernetes-version 1.16.13\\n\")), mdx(\"p\", null, \"This will warn you about the availability of your cluster, which you will need to acknowledge:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"Kubernetes may be unavailable during cluster upgrades.\\nAre you sure you want to perform this operation? (y/n): y\\n\")), mdx(\"p\", null, \"When I ran this command for the first time, I received the following warning:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"Operation failed with status: 'Bad Request'. Details: Unable to retrieve log analytics workspace. Resource ID: /subscriptions/***/resourcegroups/defaultresourcegroup-suk/providers/microsoft.operationalinsights/workspaces/***-law. \\nIf resource is intentionally deleted to stop monitoring, please also disable monitoring addon by following doc: https://aka.ms/aks-disable-monitoring-addon. \\nIf resource is deleted by mistake, please re-create it by following doc: https://aka.ms/new-log-analytics, and enable new workspace resource id by following doc: https://aka.ms/aks-enable-addons\\n\")), mdx(\"p\", null, \"This was resolved by temporarily removing the monitoring addon with the following command:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"C:\\\\> az aks disable-addons -a monitoring -n *** -g ***\\n\")), mdx(\"p\", null, \"After resolving this issue, I re-ran the command to upgrade the cluster, this time I saw a progress message:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"C:\\\\> az aks upgrade --resource-group *** --name *** --kubernetes-version 1.16.13\\nKubernetes may be unavailable during cluster upgrades.\\nAre you sure you want to perform this operation? (y/n): y\\n - Running ..\\n\")), mdx(\"p\", null, \"Eventually this outputted a json result of the state of the cluster following the upgrade:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-json\"\n  }), \"{\\n  \\\"aadProfile\\\": null,\\n  \\\"addonProfiles\\\": {\\n    \\\"KubeDashboard\\\": {\\n      \\\"config\\\": null,\\n      \\\"enabled\\\": true,\\n      \\\"identity\\\": null\\n    },\\n    \\\"httpApplicationRouting\\\": {\\n      \\\"config\\\": null,\\n      \\\"enabled\\\": false,\\n      \\\"identity\\\": null\\n    },\\n    \\\"omsagent\\\": {\\n      \\\"config\\\": null,\\n      \\\"enabled\\\": false,\\n      \\\"identity\\\": null\\n    }\\n  },\\n  \\\"agentPoolProfiles\\\": [\\n    {\\n      \\\"availabilityZones\\\": null,\\n      \\\"count\\\": 3,\\n      \\\"enableAutoScaling\\\": null,\\n      \\\"enableNodePublicIp\\\": null,\\n      \\\"maxCount\\\": null,\\n      \\\"maxPods\\\": 30,\\n      \\\"minCount\\\": null,\\n      \\\"mode\\\": \\\"User\\\",\\n      \\\"name\\\": \\\"agentpool\\\",\\n      \\\"nodeLabels\\\": null,\\n      \\\"nodeTaints\\\": null,\\n      \\\"orchestratorVersion\\\": \\\"1.16.13\\\",\\n      \\\"osDiskSizeGb\\\": 100,\\n      \\\"osType\\\": \\\"Linux\\\",\\n      \\\"provisioningState\\\": \\\"Succeeded\\\",\\n      \\\"scaleSetEvictionPolicy\\\": null,\\n      \\\"scaleSetPriority\\\": null,\\n      \\\"spotMaxPrice\\\": null,\\n      \\\"tags\\\": null,\\n      \\\"type\\\": \\\"AvailabilitySet\\\",\\n      \\\"vmSize\\\": \\\"Standard_D4s_v3\\\",\\n      \\\"vnetSubnetId\\\": \\\"/subscriptions/***/resourceGroups/***/providers/Microsoft...\\\"\\n    }\\n  ],\\n  \\\"apiServerAccessProfile\\\": null,\\n  \\\"autoScalerProfile\\\": null,\\n  \\\"diskEncryptionSetId\\\": null,\\n  \\\"dnsPrefix\\\": \\\"***\\\",\\n  \\\"enablePodSecurityPolicy\\\": null,\\n  \\\"enableRbac\\\": false,\\n  \\\"fqdn\\\": \\\"***\\\",\\n  \\\"id\\\": \\\"/subscriptions/***/resourcegroups/***/providers/Microsoft.ContainerService/...\\\",\\n  \\\"identity\\\": null,\\n  \\\"identityProfile\\\": null,\\n  \\\"kubernetesVersion\\\": \\\"1.16.13\\\",\\n  \\\"linuxProfile\\\": null,\\n  \\\"location\\\": \\\"uksouth\\\",\\n  \\\"maxAgentPools\\\": 1,\\n  \\\"name\\\": \\\"***\\\",\\n  \\\"networkProfile\\\": {\\n    \\\"dnsServiceIp\\\": \\\"***\\\",\\n    \\\"dockerBridgeCidr\\\": \\\"***\\\",\\n    \\\"loadBalancerProfile\\\": null,\\n    \\\"loadBalancerSku\\\": \\\"Basic\\\",\\n    \\\"networkMode\\\": null,\\n    \\\"networkPlugin\\\": \\\"azure\\\",\\n    \\\"networkPolicy\\\": null,\\n    \\\"outboundType\\\": \\\"loadBalancer\\\",\\n    \\\"podCidr\\\": null,\\n    \\\"serviceCidr\\\": \\\"***\\\"\\n  },\\n  \\\"nodeResourceGroup\\\": \\\"***\\\",\\n  \\\"privateFqdn\\\": null,\\n  \\\"provisioningState\\\": \\\"Succeeded\\\",\\n  \\\"resourceGroup\\\": \\\"***\\\",\\n  \\\"servicePrincipalProfile\\\": {\\n    \\\"clientId\\\": \\\"***\\\",\\n    \\\"secret\\\": null\\n  },\\n  \\\"sku\\\": null,\\n  \\\"tags\\\": {\\n    \\\"environment\\\": \\\"sit\\\"\\n  },\\n  \\\"type\\\": \\\"Microsoft.ContainerService/ManagedClusters\\\",\\n  \\\"windowsProfile\\\": null\\n}\\nC:\\\\>\\n\")), mdx(\"p\", null, \"Finally, I was able to verify that I had got to the final version that was supported on AKS at the time,\\nverifying with the previous command to check for upgrades, that there were no further upgrades available:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-json\"\n  }), \"C:\\\\> az aks get-upgrades --resource-group *** --name ***\\n{\\n  \\\"agentPoolProfiles\\\": [\\n    {\\n      \\\"kubernetesVersion\\\": \\\"1.18.8\\\",\\n      \\\"name\\\": null,\\n      \\\"osType\\\": \\\"Linux\\\",\\n      \\\"upgrades\\\": null\\n    }\\n  ],\\n  \\\"controlPlaneProfile\\\": {\\n    \\\"kubernetesVersion\\\": \\\"1.18.8\\\",\\n    \\\"name\\\": null,\\n    \\\"osType\\\": \\\"Linux\\\",\\n    \\\"upgrades\\\": null\\n  },\\n  \\\"id\\\": \\\"/subscriptions/***/resourcegroups/***/providers/Microsoft.ContainerService...\\\",\\n  \\\"name\\\": \\\"default\\\",\\n  \\\"resourceGroup\\\": \\\"***\\\",\\n  \\\"type\\\": \\\"Microsoft.ContainerService/managedClusters/upgradeprofiles\\\"\\n}\\nC:\\\\>\\n\")));\n}\n;\nMDXContent.isMDXComponent = true;","hero":{"full":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAHABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAQC/8QAFwEAAwEAAAAAAAAAAAAAAAAAAAEDBP/aAAwDAQACEAMQAAABhwaI1AX/xAAZEAACAwEAAAAAAAAAAAAAAAAAAgEDEhP/2gAIAQEAAQUCm5js5VOl/8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQMBAT8Bh//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABgQAAMBAQAAAAAAAAAAAAAAAAARkUEB/9oACAEBAAY/AshkH1Q//8QAGRABAAIDAAAAAAAAAAAAAAAAAQARMbHw/9oACAEBAAE/IRqaZxMVhvdYT//aAAwDAQACAAMAAAAQcC//xAAXEQADAQAAAAAAAAAAAAAAAAAAATER/9oACAEDAQE/EEmQdP/EABYRAQEBAAAAAAAAAAAAAAAAAAEAEf/aAAgBAgEBPxDWFv/EABwQAQACAgMBAAAAAAAAAAAAAAEAESFhMVHB8P/aAAgBAQABPxADNRQtfIty/fURiDwLFHRuf//Z","aspectRatio":2.9135802469135803,"src":"/static/b853528b32121bf5051625cea3a51353/e436c/aks.jpg","srcSet":"/static/b853528b32121bf5051625cea3a51353/e0f30/aks.jpg 236w,\n/static/b853528b32121bf5051625cea3a51353/86afd/aks.jpg 472w,\n/static/b853528b32121bf5051625cea3a51353/e436c/aks.jpg 899w","srcWebp":"/static/b853528b32121bf5051625cea3a51353/f5dd8/aks.webp","srcSetWebp":"/static/b853528b32121bf5051625cea3a51353/77392/aks.webp 236w,\n/static/b853528b32121bf5051625cea3a51353/1f177/aks.webp 472w,\n/static/b853528b32121bf5051625cea3a51353/f5dd8/aks.webp 899w","sizes":"(max-width: 899px) 100vw, 899px"},"regular":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAHABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAQC/8QAFwEAAwEAAAAAAAAAAAAAAAAAAAEDBP/aAAwDAQACEAMQAAABhwaI1AX/xAAZEAACAwEAAAAAAAAAAAAAAAAAAgEDEhP/2gAIAQEAAQUCm5js5VOl/8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQMBAT8Bh//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABgQAAMBAQAAAAAAAAAAAAAAAAARkUEB/9oACAEBAAY/AshkH1Q//8QAGRABAAIDAAAAAAAAAAAAAAAAAQARMbHw/9oACAEBAAE/IRqaZxMVhvdYT//aAAwDAQACAAMAAAAQcC//xAAXEQADAQAAAAAAAAAAAAAAAAAAATER/9oACAEDAQE/EEmQdP/EABYRAQEBAAAAAAAAAAAAAAAAAAEAEf/aAAgBAgEBPxDWFv/EABwQAQACAgMBAAAAAAAAAAAAAAEAESFhMVHB8P/aAAgBAQABPxADNRQtfIty/fURiDwLFHRuf//Z","aspectRatio":2.9107142857142856,"src":"/static/b853528b32121bf5051625cea3a51353/1dc0b/aks.jpg","srcSet":"/static/b853528b32121bf5051625cea3a51353/3a5ce/aks.jpg 163w,\n/static/b853528b32121bf5051625cea3a51353/05730/aks.jpg 327w,\n/static/b853528b32121bf5051625cea3a51353/1dc0b/aks.jpg 653w,\n/static/b853528b32121bf5051625cea3a51353/e436c/aks.jpg 899w","srcWebp":"/static/b853528b32121bf5051625cea3a51353/0acdf/aks.webp","srcSetWebp":"/static/b853528b32121bf5051625cea3a51353/ac59e/aks.webp 163w,\n/static/b853528b32121bf5051625cea3a51353/7660b/aks.webp 327w,\n/static/b853528b32121bf5051625cea3a51353/0acdf/aks.webp 653w,\n/static/b853528b32121bf5051625cea3a51353/f5dd8/aks.webp 899w","sizes":"(max-width: 653px) 100vw, 653px"},"narrow":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAHABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAQC/8QAFwEAAwEAAAAAAAAAAAAAAAAAAAEDBP/aAAwDAQACEAMQAAABhwaI1AX/xAAZEAACAwEAAAAAAAAAAAAAAAAAAgEDEhP/2gAIAQEAAQUCm5js5VOl/8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQMBAT8Bh//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABgQAAMBAQAAAAAAAAAAAAAAAAARkUEB/9oACAEBAAY/AshkH1Q//8QAGRABAAIDAAAAAAAAAAAAAAAAAQARMbHw/9oACAEBAAE/IRqaZxMVhvdYT//aAAwDAQACAAMAAAAQcC//xAAXEQADAQAAAAAAAAAAAAAAAAAAATER/9oACAEDAQE/EEmQdP/EABYRAQEBAAAAAAAAAAAAAAAAAAEAEf/aAAgBAgEBPxDWFv/EABwQAQACAgMBAAAAAAAAAAAAAAEAESFhMVHB8P/aAAgBAQABPxADNRQtfIty/fURiDwLFHRuf//Z","aspectRatio":2.923076923076923,"src":"/static/b853528b32121bf5051625cea3a51353/eaa58/aks.jpg","srcSet":"/static/b853528b32121bf5051625cea3a51353/5a3ee/aks.jpg 114w,\n/static/b853528b32121bf5051625cea3a51353/41f8f/aks.jpg 229w,\n/static/b853528b32121bf5051625cea3a51353/eaa58/aks.jpg 457w,\n/static/b853528b32121bf5051625cea3a51353/c309b/aks.jpg 686w,\n/static/b853528b32121bf5051625cea3a51353/e436c/aks.jpg 899w","srcWebp":"/static/b853528b32121bf5051625cea3a51353/15384/aks.webp","srcSetWebp":"/static/b853528b32121bf5051625cea3a51353/31fce/aks.webp 114w,\n/static/b853528b32121bf5051625cea3a51353/e3e25/aks.webp 229w,\n/static/b853528b32121bf5051625cea3a51353/15384/aks.webp 457w,\n/static/b853528b32121bf5051625cea3a51353/0258d/aks.webp 686w,\n/static/b853528b32121bf5051625cea3a51353/f5dd8/aks.webp 899w","sizes":"(max-width: 457px) 100vw, 457px"},"seo":{"src":"/static/b853528b32121bf5051625cea3a51353/e436c/aks.jpg"}}}]}},"staticQueryHashes":["1143375668","1491088328","1921650733","2068910035","2444214635"]}